import{b as F,s as Q,S as K}from"./service-97f28bed.js";import{m as O,i as X,r as p,h as W,a as Z,o as _,c as h,b as t,d as M,w as at,t as R,E,M as D,F as B,v as H,H as N,n as z,O as nt,p as tt,f as et,k as A,l as dt,s as it,P as lt,q as ct,Q as rt,u as G,L as ut,j as mt}from"./index-72fe37f2.js";import{P as pt}from"./PaginationComponent-b02a4f43.js";import{M as st}from"./modal-8cd452d7.js";import{_ as ot}from"./plugin-vueexport-helper-c27b6911.js";import"./component-functions-e1de1c19.js";const U=n=>(tt("data-v-1b35131f"),n=n(),et(),n),_t={id:"productModal",ref:"productModalDom",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},vt={class:"modal-dialog modal-xl"},bt={class:"modal-content border-0"},ht={class:"modal-header bg-dark text-white"},ft={id:"productModalLabel",class:"modal-title text-white"},gt=U(()=>t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),yt={class:"modal-body"},$t={class:"row"},Ut={class:"col-sm-4"},kt={class:"mb-2"},wt={class:"mb-3"},xt=U(()=>t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1)),Ct=["src"],Pt={class:"mb-2"},It={class:"mb-3"},Mt=U(()=>t("label",{for:"imagesUrl",class:"form-label"},"輸入子圖片組",-1)),St={class:"row"},Vt={class:"px-1 py-2"},Lt=["src"],Et=["onClick"],Dt={class:"col-sm-8"},Rt={class:"mb-3"},Tt=U(()=>t("label",{for:"title",class:"form-label"},[t("span",{class:"text-danger"},"*"),A(" 標題 ")],-1)),Ft={class:"row"},At={class:"mb-3 col-md-6"},qt=U(()=>t("label",{for:"category",class:"form-label"},[t("span",{class:"text-danger"},"*"),A(" 分類")],-1)),Bt={class:"mb-3 col-md-6"},Nt=U(()=>t("label",{for:"price",class:"form-label"},[t("span",{class:"text-danger"},"*"),A(" 單位")],-1)),Ot={class:"row"},jt={class:"mb-3 col-md-6"},zt=U(()=>t("label",{for:"origin_price",class:"form-label"},"原價",-1)),Gt={class:"mb-3 col-md-6"},Ht=U(()=>t("label",{for:"price",class:"form-label"},"售價",-1)),Xt={class:"row"},Wt={class:"col-6"},Jt={class:"d-flex"},Yt=U(()=>t("h6",null,"星等：",-1)),Qt={class:"rating"},Kt=["onClick"],Zt=U(()=>t("hr",null,null,-1)),te={class:"mb-3"},ee=U(()=>t("label",{for:"content",class:"form-label"},"產品描述",-1)),se={class:"mb-3"},oe=U(()=>t("label",{for:"content",class:"form-label"},"說明內容",-1)),le={class:"mb-3"},ae={class:"form-check"},ne=U(()=>t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1)),de={class:"modal-footer"},ie=U(()=>t("button",{type:"submit",class:"btn btn-primary"}," 確認 ",-1)),ce={__name:"AddEditProductModal",emits:["getProducts"],setup(n,{expose:k,emit:c}){const g=O(),v=X("$swal"),{setLoading:y}=g,$="https://vue3-course-api.hexschool.io/v2",P="vue3",C=p(null),s=p({title:"",unit:"",category:"",imageUrl:""}),d=p(""),w=p(""),S=(r,o)=>{C.value.show(),w.value=o,s.value=r},b=()=>{s.value.imagesUrl?s.value.imagesUrl.push(d.value):s.value.imagesUrl=[d.value],d.value=""},a=r=>{s.value.imagesUrl.splice(r,1)},f=r=>{const o=w.value==="new"?"post":"put",x=w.value==="new"?`${$}/api/${P}/admin/product`:`${$}/api/${P}/admin/product/${r}`,u={data:s.value};y(!0),F({method:o,url:x,data:u}).then(({data:l})=>{l.success&&(y(!1),c("getProducts"),C.value.hide(),v(l.message))}).catch(l=>{var e,V,q,m;let i=(V=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:V.message;Array.isArray((m=(q=l==null?void 0:l.response)==null?void 0:q.data)==null?void 0:m.message)?i=i.join(","):i=i.message,v("",i||"有錯誤","error"),y(!1)})};return W(()=>{var o;const r=(o=document.cookie.split("; ").find(x=>x.startsWith("ttShopToken=")))==null?void 0:o.split("=")[1];C.value=new st("#productModal",{focus:!1}),F.defaults.headers.common.Authorization=r}),k({show:S}),(r,o)=>{const x=Z("VField"),u=Z("ErrorMessage"),l=Z("VForm");return _(),h("div",_t,[t("div",vt,[t("div",bt,[M(l,{onSubmit:o[12]||(o[12]=i=>f(s.value.id))},{default:at(({errors:i})=>[t("div",ht,[t("h5",ft,[t("span",null,R(w.value==="new"?"新增":"編輯")+"產品",1)]),gt]),t("div",yt,[t("div",$t,[t("div",Ut,[t("div",kt,[t("div",wt,[xt,E(t("input",{id:"imageUrl","onUpdate:modelValue":o[0]||(o[0]=e=>s.value.imageUrl=e),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[D,s.value.imageUrl,void 0,{trim:!0}]])]),t("img",{class:"img-fluid",src:s.value.imageUrl,alt:"圖片預覽"},null,8,Ct)]),t("div",Pt,[t("div",It,[Mt,E(t("input",{id:"imagesUrl","onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[D,d.value,void 0,{trim:!0}]])]),t("div",St,[(_(!0),h(B,null,H(s.value.imagesUrl,(e,V)=>(_(),h("div",{key:e,class:"position-relative col-4"},[t("div",Vt,[t("img",{class:"img-fluid",src:e,alt:"圖片預覽"},null,8,Lt),t("button",{class:"btn btn-outline-primary rounded-circle position-absolute top-0 end-0 py-1 px-2",onClick:q=>a(V)}," X ",8,Et)])]))),128))])]),t("div",null,[d.value!==""?(_(),h("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",onClick:b}," 新增圖片 ")):N("",!0)])]),t("div",Dt,[t("div",Rt,[Tt,M(x,{id:"title",modelValue:s.value.title,"onUpdate:modelValue":o[2]||(o[2]=e=>s.value.title=e),modelModifiers:{trim:!0},name:"標題",type:"text",class:z(["form-control",{"is-invalid":i.標題}]),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),M(u,{name:"標題",class:"invalid-feedback"})]),t("div",Ft,[t("div",At,[qt,M(x,{id:"category",modelValue:s.value.category,"onUpdate:modelValue":o[3]||(o[3]=e=>s.value.category=e),modelModifiers:{trim:!0},name:"分類",type:"text",class:z(["form-control",{"is-invalid":i.分類}]),placeholder:"請輸入分類",rules:"required"},null,8,["modelValue","class"]),M(u,{name:"分類",class:"invalid-feedback"})]),t("div",Bt,[Nt,M(x,{id:"unit",modelValue:s.value.unit,"onUpdate:modelValue":o[4]||(o[4]=e=>s.value.unit=e),modelModifiers:{trim:!0},name:"單位",type:"text",class:z(["form-control",{"is-invalid":i.單位}]),placeholder:"請輸入單位",rules:"required"},null,8,["modelValue","class"]),M(u,{name:"單位",class:"invalid-feedback"})])]),t("div",Ot,[t("div",jt,[zt,E(t("input",{id:"origin_price","onUpdate:modelValue":o[5]||(o[5]=e=>s.value.origin_price=e),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[D,s.value.origin_price,void 0,{number:!0}]])]),t("div",Gt,[Ht,E(t("input",{id:"price","onUpdate:modelValue":o[6]||(o[6]=e=>s.value.price=e),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[D,s.value.price,void 0,{number:!0}]])])]),t("div",Xt,[t("div",Wt,[t("div",Jt,[Yt,t("div",Qt,[(_(),h(B,null,H(5,e=>t("span",{key:e,class:z(["star",{active:e<=s.value.star}]),onClick:V=>s.value.star=e},null,10,Kt)),64)),E(t("input",{"onUpdate:modelValue":o[7]||(o[7]=e=>s.value.star=e),type:"hidden"},null,512),[[D,s.value.star]])])])])]),Zt,t("div",te,[ee,E(t("textarea",{id:"content","onUpdate:modelValue":o[8]||(o[8]=e=>s.value.content=e),type:"text",class:"form-control",placeholder:"請輸入產品描述"},null,512),[[D,s.value.content]])]),t("div",se,[oe,E(t("textarea",{id:"description","onUpdate:modelValue":o[9]||(o[9]=e=>s.value.description=e),type:"text",class:"form-control",placeholder:"請輸入說明內容"},null,512),[[D,s.value.description]])]),t("div",le,[t("div",ae,[E(t("input",{id:"is_enabled","onUpdate:modelValue":o[10]||(o[10]=e=>s.value.is_enabled=e),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[nt,s.value.is_enabled]]),ne])])])])]),t("div",de,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:o[11]||(o[11]=(...e)=>r.resetProduct&&r.resetProduct(...e))}," 取消 "),ie])]),_:1})])])],512)}}},re=ot(ce,[["__scopeId","data-v-1b35131f"]]),ue={id:"deleteProductModalDom",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},me={class:"modal-dialog"},pe={class:"modal-content border-0"},_e=t("div",{class:"modal-header bg-danger"},[t("h5",{id:"delProductModalLabel",class:"modal-title text-white"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ve={class:"modal-body"},be={class:"text-danger"},he={class:"modal-footer"},fe=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),ge={__name:"DeleteProductModal",emits:["getProducts"],setup(n,{expose:k,emit:c}){const g=O(),v=X("$swal"),{setLoading:y}=g,$="https://vue3-course-api.hexschool.io/v2",P="vue3",C=p(null),s=p(0),d=p(""),w=({id:b,title:a})=>{C.value.show(),s.value=b,d.value=a},S=b=>{y(!0),F({method:"DELETE",url:`${$}/api/${P}/admin/product/${b}`}).then(({data:a})=>{a.success&&(y(!1),v(a.message),c("getProducts"),C.value.hide())}).catch(a=>{var f,r;v("",((r=(f=a==null?void 0:a.response)==null?void 0:f.data)==null?void 0:r.message)||"有錯誤","error"),y(!1)})};return W(()=>{var a;const b=(a=document.cookie.split("; ").find(f=>f.startsWith("ttShopToken=")))==null?void 0:a.split("=")[1];C.value=new st("#deleteProductModalDom",{focus:!1}),F.defaults.headers.common.Authorization=b}),k({show:w}),(b,a)=>(_(),h("div",ue,[t("div",me,[t("div",pe,[_e,t("div",ve,[A(" 是否刪除 "),t("strong",be,R(d.value),1),A(" 商品(刪除後將無法恢復)。 ")]),t("div",he,[fe,t("button",{type:"button",class:"btn btn-danger",onClick:a[0]||(a[0]=f=>S(s.value))}," 確認刪除 ")])])])]))}},ye=O(),{setLoading:T}=ye,$e=dt("uploadImages",{state:()=>({imagesUrl:[]}),getters:{gettersImagesUrl:({imagesUrl:n})=>n},actions:{setImage(n){const k="/admin/upload",c=new FormData;return c.append("file-to-upload",n),Q({method:"post",url:k,data:c})},deleteImageUrl(n){this.imagesUrl.splice(n,1),this.updateImagesUrl()},async updateImagesUrl(n,k=!1){var v,y;n&&this.imagesUrl.push(n);const c={category:"圖床",content:"圖床用",description:"圖床用",id:"-NOqSXY5EM4pdTaqnSJr",imageUrl:"",is_enabled:0,num:1,origin_price:100,price:100,star:5,title:"圖床",unit:"張",imagesUrl:this.imagesUrl},g=`/admin/product/${c.id}`;T(!0);try{const{data:$}=await Q({method:"put",url:g,data:{data:c}});if(T(!1),$.success){const P=k?"已上傳圖片":"已刪除圖片";K.fire({text:P,customClass:{container:"position-absolute"},toast:!0,showConfirmButton:!1,position:"bottom-right",timer:1500}),this.getImagesUrl()}}catch($){K.fire("",((y=(v=$==null?void 0:$.response)==null?void 0:v.data)==null?void 0:y.message)||"有錯誤","error"),T(!1)}},getImagesUrl(){const n="-NOqSXY5EM4pdTaqnSJr",k="/admin/products/all";T(!0),Q({method:"get",url:k}).then(({data:c})=>{this.imagesUrl=c.products[n].imagesUrl||[],T(!1)}).catch(c=>{var g,v;K.fire("",((v=(g=c==null?void 0:c.response)==null?void 0:g.data)==null?void 0:v.message)||"有錯誤","error"),T(!1)})}}});const j=n=>(tt("data-v-ebd0b49a"),n=n(),et(),n),Ue={id:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"modalLabel","aria-hidden":"true"},ke={class:"modal-dialog modal-xl"},we={class:"modal-content border-0"},xe=j(()=>t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"modalLabel",class:"modal-title"},[t("span",null,"上傳檔案")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Ce={class:"modal-body"},Pe={class:"row"},Ie={class:"col-6"},Me=j(()=>t("h3",null,"上傳檔案",-1)),Se={class:"input-group"},Ve=["disabled"],Le=["src"],Ee={class:"col-6"},De=j(()=>t("h3",null,"上傳完成",-1)),Re=["disabled"],Te=["disabled"],Fe=["src"],Ae=j(()=>t("hr",null,null,-1)),qe={class:"row"},Be=j(()=>t("h3",null,"儲存圖片的連結(點選取得連結)",-1)),Ne={class:"row"},Oe={class:"px-1 py-2"},je=["value"],ze=["onClick"],Ge=["src"],He=["onClick"],Xe={class:"modal-footer"},We={__name:"UploadImageModal",setup(n,{expose:k}){const c=O(),g=$e(),{getImagesUrl:v,setImage:y,updateImagesUrl:$,deleteImageUrl:P}=g,{gettersImagesUrl:C}=it(g),s=X("$swal"),{setLoading:d}=c,w=new FileReader,S=p(null),b=p(""),a=p(""),f=p(null),r=lt(null),o=ct(()=>C.value),x=lt([]),u=()=>{S.value.show()},l=()=>{if(!f.value)return s("檔案不得為空"),!1;d(!0),y(f.value).then(({data:m})=>{d(!1),a.value=m.imageUrl}).catch(m=>{var L,I;d(!1),s("",((I=(L=m==null?void 0:m.response)==null?void 0:L.data)==null?void 0:I.message)||"有錯誤","error")})},i=m=>{w.readAsDataURL(m.target.files[0]),f.value=m.target.files[0]},e=m=>{b.value=m.target.result},V=()=>{r.value.select(),document.execCommand("copy"),s({text:"已複製",customClass:{container:"position-absolute"},toast:!0,showConfirmButton:!1,position:"bottom-right",timer:1500})},q=m=>{x.value[m].select(),document.execCommand("copy"),s({text:"已複製",customClass:{container:"position-absolute"},toast:!0,showConfirmButton:!1,position:"bottom-right",timer:1500})};return W(()=>{S.value=new st("#modal",{focus:!1}),v(),w.addEventListener("load",e)}),rt(()=>{w.removeEventListener("load",e)}),k({show:u}),(m,L)=>(_(),h("div",Ue,[t("div",ke,[t("div",we,[xe,t("div",Ce,[t("div",Pe,[t("div",Ie,[Me,t("div",Se,[t("input",{id:"inputGroupFile04",type:"file",class:"form-control","aria-describedby":"fileInput","aria-label":"Upload",onChange:i},null,32),t("button",{id:"fileInput",class:"btn btn-outline-secondary",type:"button",disabled:b.value==="",onClick:l},R(b.value===""?"選擇":"上傳")+"圖片 ",9,Ve)]),A(" 預覽圖片 "),b.value?(_(),h("img",{key:0,src:b.value,alt:"預覽圖片"},null,8,Le)):N("",!0)]),t("div",Ee,[De,t("button",{class:"btn btn-sm btn-primary me-2",disabled:a.value==="",onClick:V}," 複製上傳連結 ",8,Re),t("button",{class:"btn btn-sm btn-primary",disabled:a.value==="",onClick:L[0]||(L[0]=I=>G($)(a.value,!0))}," 儲存上傳連結 ",8,Te),E(t("input",{ref_key:"finishUrlDom",ref:r,"onUpdate:modelValue":L[1]||(L[1]=I=>a.value=I),type:"text",placeholder:"上傳後的圖片連結",readonly:"readonly"},null,512),[[D,a.value]]),a.value?(_(),h("img",{key:0,src:a.value,alt:"上傳後的圖片"},null,8,Fe)):N("",!0)]),Ae,t("div",qe,[Be,t("div",Ne,[(_(!0),h(B,null,H(G(o),(I,J)=>(_(),h("div",{key:I,class:"position-relative col-4"},[t("div",Oe,[t("input",{ref_for:!0,ref:Y=>G(x)[J]=Y,value:I,type:"text",readonly:"readonly"},null,8,je),t("button",{class:"btn btn-sm btn-primary",onClick:Y=>q(J)}," 點擊複製 ",8,ze),t("img",{class:"img-fluid",src:I,alt:"預覽複製的圖片"},null,8,Ge),t("button",{class:"btn btn-outline-primary rounded-circle position-absolute top-0 end-0 py-1 px-2",onClick:Y=>G(P)(J)}," X ",8,He)])]))),128))])])])]),t("div",Xe,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:L[2]||(L[2]=(...I)=>m.resetProduct&&m.resetProduct(...I))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:l}," 確認 ")])])])]))}},Je=ot(We,[["__scopeId","data-v-ebd0b49a"]]);const Ye=n=>(tt("data-v-96f20881"),n=n(),et(),n),Qe={class:"container"},Ke={class:"text-end mt-4"},Ze={class:"table mt-4"},ts=Ye(()=>t("thead",null,[t("tr",null,[t("th",{width:"120"}," 分類 "),t("th",null,"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1)),es={class:"text-end"},ss={class:"text-end"},os={key:0,class:"text-success"},ls={key:1},as={class:"btn-group"},ns=["onClick"],ds=["onClick"],is={key:0},cs={__name:"DashboardProducts",setup(n){const k=ut(),c=O(),g=X("$swal"),{setLoading:v}=c,y="https://vue3-course-api.hexschool.io/v2",$="vue3",P={category:"",content:"",description:"",imageUrl:"",imagesUrl:[],is_enabled:"",num:"",origin_price:0,price:0,title:"",unit:""},C=p([]),s=p({...P}),d=p(null),w=p(""),S=p(null),b=p(null),a=p(null),f=(u=1)=>{x(),v(!0),F.get(`${y}/api/${$}/admin/products?page=${u}`).then(({data:l})=>{C.value=l.products,d.value=l.pagination}).catch(l=>{var i,e;v(!1),g("",((e=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:e.message)||"有錯誤","error"),k.push({name:"Login"})}).finally(()=>v(!1))},r=()=>{b.value.show()},o=(u,l)=>{w.value=u,u==="new"?x():s.value=l,u==="new"||u==="edit"?S.value.show(s.value,w.value):u==="delete"?a.value.show(l):g("錯誤")},x=()=>{s.value={...P}};return W(()=>{var l;const u=(l=document.cookie.split("; ").find(i=>i.startsWith("ttShopToken=")))==null?void 0:l.split("=")[1];F.defaults.headers.common.Authorization=u,f()}),(u,l)=>{var i;return _(),h(B,null,[t("div",Qe,[t("div",Ke,[t("button",{class:"btn btn-primary me-3",onClick:r}," 上傳圖片 "),t("button",{class:"btn btn-primary",onClick:l[0]||(l[0]=e=>o("new"))}," 建立新的產品 ")]),t("table",Ze,[ts,t("tbody",null,[(_(!0),h(B,null,H(C.value,e=>(_(),h("tr",{key:e.id},[t("td",null,R(e.category),1),t("td",null,R(e.title),1),t("td",es,R(e.origin_price),1),t("td",ss,R(e.price),1),t("td",null,[e.is_enabled?(_(),h("span",os,"啟用")):(_(),h("span",ls,"未啟用"))]),t("td",null,[t("div",as,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:V=>o("edit",e)}," 編輯 ",8,ns),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:V=>o("delete",e)}," 刪除 ",8,ds)])])]))),128))])]),(i=d.value)!=null&&i.total_pages?(_(),h("div",is,[d.value?(_(),mt(pt,{key:0,"current-page":d.value.current_page,"total-pages":d.value.total_pages,"has-next":d.value.has_next,"has-pre":d.value.has_pre,onGetPage:f},null,8,["current-page","total-pages","has-next","has-pre"])):N("",!0)])):N("",!0)]),M(re,{ref_key:"addEditProductRef",ref:S,onGetProducts:f},null,512),M(ge,{ref_key:"deleteProductRef",ref:a,onGetProducts:f},null,512),M(Je,{ref_key:"uploadImageRef",ref:b},null,512)],64)}}},bs=ot(cs,[["__scopeId","data-v-96f20881"]]);export{bs as default};
