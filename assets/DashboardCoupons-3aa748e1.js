import{P as ct}from"./PaginationComponent-930fbe8c.js";import{g as ht,i as at,r as T,h as ot,a as et,o as F,c as I,b as a,d as L,w as ft,t as E,n as q,E as lt,M as mt,O as pt,I as vt,k as z,F as _t,v as $t,j as gt,H as bt,u as yt}from"./index-5356cf8e.js";import{M as ut}from"./modal-57346e3c.js";import{s as K}from"./service-76d60509.js";import{g as Mt}from"./filters-87564b85.js";import"./plugin-vueexport-helper-c27b6911.js";import"./component-functions-4ab743b4.js";function wt(w=1){return K({method:"GET",url:`/admin/coupons?page=${w}`})}function Dt(w){return K({method:"Delete",url:`/admin/coupon/${w}`})}function St(w){return K({method:"PUT",url:`/admin/coupon/${w.id}`,data:{data:w}})}function xt(w){return K({method:"POST",url:"/admin/coupon",data:{data:w}})}var st={},Ct={get exports(){return st},set exports(w){st=w}};(function(w,N){(function(V,p){w.exports=p()})(ht,function(){var V=1e3,p=6e4,k=36e5,D="millisecond",S="second",d="minute",y="hour",r="day",_="week",e="month",h="quarter",v="year",g="date",O="Invalid Date",x=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,dt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(o){var s=["th","st","nd","rd"],t=o%100;return"["+o+(s[(t-20)%10]||s[t]||s[0])+"]"}},R=function(o,s,t){var i=String(o);return!i||i.length>=s?o:""+Array(s+1-i.length).join(t)+o},rt={s:R,z:function(o){var s=-o.utcOffset(),t=Math.abs(s),i=Math.floor(t/60),n=t%60;return(s<=0?"+":"-")+R(i,2,"0")+":"+R(n,2,"0")},m:function o(s,t){if(s.date()<t.date())return-o(t,s);var i=12*(t.year()-s.year())+(t.month()-s.month()),n=s.clone().add(i,e),u=t-n<0,l=s.clone().add(i+(u?-1:1),e);return+(-(i+(t-n)/(u?n-l:l-n))||0)},a:function(o){return o<0?Math.ceil(o)||0:Math.floor(o)},p:function(o){return{M:e,y:v,w:_,d:r,D:g,h:y,m:d,s:S,ms:D,Q:h}[o]||String(o||"").toLowerCase().replace(/s$/,"")},u:function(o){return o===void 0}},P="en",U={};U[P]=dt;var X=function(o){return o instanceof Z},J=function o(s,t,i){var n;if(!s)return P;if(typeof s=="string"){var u=s.toLowerCase();U[u]&&(n=u),t&&(U[u]=t,n=u);var l=s.split("-");if(!n&&l.length>1)return o(l[0])}else{var c=s.name;U[c]=s,n=c}return!i&&n&&(P=n),n||!i&&P},b=function(o,s){if(X(o))return o.clone();var t=typeof s=="object"?s:{};return t.date=o,t.args=arguments,new Z(t)},f=rt;f.l=J,f.i=X,f.w=function(o,s){return b(o,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var Z=function(){function o(t){this.$L=J(t.locale,null,!0),this.parse(t)}var s=o.prototype;return s.parse=function(t){this.$d=function(i){var n=i.date,u=i.utc;if(n===null)return new Date(NaN);if(f.u(n))return new Date;if(n instanceof Date)return new Date(n);if(typeof n=="string"&&!/Z$/i.test(n)){var l=n.match(x);if(l){var c=l[2]-1||0,$=(l[7]||"0").substring(0,3);return u?new Date(Date.UTC(l[1],c,l[3]||1,l[4]||0,l[5]||0,l[6]||0,$)):new Date(l[1],c,l[3]||1,l[4]||0,l[5]||0,l[6]||0,$)}}return new Date(n)}(t),this.$x=t.x||{},this.init()},s.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},s.$utils=function(){return f},s.isValid=function(){return this.$d.toString()!==O},s.isSame=function(t,i){var n=b(t);return this.startOf(i)<=n&&n<=this.endOf(i)},s.isAfter=function(t,i){return b(t)<this.startOf(i)},s.isBefore=function(t,i){return this.endOf(i)<b(t)},s.$g=function(t,i,n){return f.u(t)?this[i]:this.set(n,t)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(t,i){var n=this,u=!!f.u(i)||i,l=f.p(t),c=function(W,C){var A=f.w(n.$u?Date.UTC(n.$y,C,W):new Date(n.$y,C,W),n);return u?A:A.endOf(r)},$=function(W,C){return f.w(n.toDate()[W].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(C)),n)},m=this.$W,M=this.$M,j=this.$D,H="set"+(this.$u?"UTC":"");switch(l){case v:return u?c(1,0):c(31,11);case e:return u?c(1,M):c(0,M+1);case _:var B=this.$locale().weekStart||0,G=(m<B?m+7:m)-B;return c(u?j-G:j+(6-G),M);case r:case g:return $(H+"Hours",0);case y:return $(H+"Minutes",1);case d:return $(H+"Seconds",2);case S:return $(H+"Milliseconds",3);default:return this.clone()}},s.endOf=function(t){return this.startOf(t,!1)},s.$set=function(t,i){var n,u=f.p(t),l="set"+(this.$u?"UTC":""),c=(n={},n[r]=l+"Date",n[g]=l+"Date",n[e]=l+"Month",n[v]=l+"FullYear",n[y]=l+"Hours",n[d]=l+"Minutes",n[S]=l+"Seconds",n[D]=l+"Milliseconds",n)[u],$=u===r?this.$D+(i-this.$W):i;if(u===e||u===v){var m=this.clone().set(g,1);m.$d[c]($),m.init(),this.$d=m.set(g,Math.min(this.$D,m.daysInMonth())).$d}else c&&this.$d[c]($);return this.init(),this},s.set=function(t,i){return this.clone().$set(t,i)},s.get=function(t){return this[f.p(t)]()},s.add=function(t,i){var n,u=this;t=Number(t);var l=f.p(i),c=function(M){var j=b(u);return f.w(j.date(j.date()+Math.round(M*t)),u)};if(l===e)return this.set(e,this.$M+t);if(l===v)return this.set(v,this.$y+t);if(l===r)return c(1);if(l===_)return c(7);var $=(n={},n[d]=p,n[y]=k,n[S]=V,n)[l]||1,m=this.$d.getTime()+t*$;return f.w(m,this)},s.subtract=function(t,i){return this.add(-1*t,i)},s.format=function(t){var i=this,n=this.$locale();if(!this.isValid())return n.invalidDate||O;var u=t||"YYYY-MM-DDTHH:mm:ssZ",l=f.z(this),c=this.$H,$=this.$m,m=this.$M,M=n.weekdays,j=n.months,H=function(C,A,tt,Q){return C&&(C[A]||C(i,u))||tt[A].slice(0,Q)},B=function(C){return f.s(c%12||12,C,"0")},G=n.meridiem||function(C,A,tt){var Q=C<12?"AM":"PM";return tt?Q.toLowerCase():Q},W={YY:String(this.$y).slice(-2),YYYY:this.$y,M:m+1,MM:f.s(m+1,2,"0"),MMM:H(n.monthsShort,m,j,3),MMMM:H(j,m),D:this.$D,DD:f.s(this.$D,2,"0"),d:String(this.$W),dd:H(n.weekdaysMin,this.$W,M,2),ddd:H(n.weekdaysShort,this.$W,M,3),dddd:M[this.$W],H:String(c),HH:f.s(c,2,"0"),h:B(1),hh:B(2),a:G(c,$,!0),A:G(c,$,!1),m:String($),mm:f.s($,2,"0"),s:String(this.$s),ss:f.s(this.$s,2,"0"),SSS:f.s(this.$ms,3,"0"),Z:l};return u.replace(Y,function(C,A){return A||W[C]||l.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(t,i,n){var u,l=f.p(i),c=b(t),$=(c.utcOffset()-this.utcOffset())*p,m=this-c,M=f.m(this,c);return M=(u={},u[v]=M/12,u[e]=M,u[h]=M/3,u[_]=(m-$)/6048e5,u[r]=(m-$)/864e5,u[y]=m/k,u[d]=m/p,u[S]=m/V,u)[l]||m,n?M:f.a(M)},s.daysInMonth=function(){return this.endOf(e).$D},s.$locale=function(){return U[this.$L]},s.locale=function(t,i){if(!t)return this.$L;var n=this.clone(),u=J(t,i,!0);return u&&(n.$L=u),n},s.clone=function(){return f.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},o}(),it=Z.prototype;return b.prototype=it,[["$ms",D],["$s",S],["$m",d],["$H",y],["$W",r],["$M",e],["$y",v],["$D",g]].forEach(function(o){it[o[1]]=function(s){return this.$g(s,o[0],o[1])}}),b.extend=function(o,s){return o.$i||(o(s,Z,b),o.$i=!0),b},b.locale=J,b.isDayjs=X,b.unix=function(o){return b(1e3*o)},b.en=U[P],b.Ls=U,b.p={},b})})(Ct);const nt=st,kt={id:"modal",class:"modal fade modal",tabindex:"-1","aria-hidden":"true"},Ot={class:"modal-dialog"},Vt={class:"modal-content border-0"},Yt={class:"modal-header"},Tt={id:"modalLabel",class:"modal-title"},Ht={class:"modal-body"},Lt={class:"row"},jt={class:"mb-3"},At=a("label",{for:"title",class:"form-label"},[a("span",{class:"text-danger"},"*"),z("標題")],-1),Et={class:"mb-3"},Ut=a("label",{for:"code",class:"form-label"},[a("span",{class:"text-danger"},"*"),z("折扣碼")],-1),Ft={class:"mb-3"},Nt=a("label",{for:"percent",class:"form-label"},[a("span",{class:"text-danger"},"*"),z("折扣百分比")],-1),Wt={class:"mb-3"},It=a("label",{for:"due_date",class:"form-label"},"到期日",-1),Pt={class:"mb-3"},Bt={class:"form-check form-switch form-check-reverse"},Gt=a("button",{type:"submit",class:"btn btn-secondary"}," 確認 ",-1),qt={__name:"AddEditCouponModal",emits:"getCoupons",setup(w,{expose:N,emit:V}){const p=at("$swal"),k=T(null),D=T(""),S={title:"",code:"",percent:0,is_enabled:0},d=T({...S}),y=(e,h)=>{k.value.show(),e==="created"?(D.value=e,d.value={...S}):(D.value=e,d.value={},d.value={...h,due_date:nt(h.due_date*1e3).format("YYYY-MM-DD")})},r=()=>{k.value.hide()},_=()=>{d.value.coupon=d.value.coupon*1,d.value.due_date=nt(d.value.due_date).valueOf()/1e3,D.value==="created"?xt(d.value).then(({data:e})=>{e.success&&(r(),p("成功",e.message).then(()=>V("get-coupons")))}).catch(e=>{var v,g,O,x;r();const h=((g=(v=e==null?void 0:e.response)==null?void 0:v.data)==null?void 0:g.message.length)>0?(x=(O=e==null?void 0:e.response)==null?void 0:O.data)==null?void 0:x.message.join():"有錯誤";p.fire("錯誤",h,"error")}):D.value==="edit"&&St(d.value).then(({data:e})=>{e.success?(r(),p("修改成功",e.message).then(()=>{V("get-coupons")})):(d.value.due_date=nt(d.value.due_date*1e3).format("YYYY-MM-DD"),p("錯誤",e.message.join(),"error"))}).catch(e=>{var v,g,O,x;r();const h=((g=(v=e==null?void 0:e.response)==null?void 0:v.data)==null?void 0:g.message.length)>0?(x=(O=e==null?void 0:e.response)==null?void 0:O.data)==null?void 0:x.message.join():"有錯誤";p.fire("錯誤",h,"error")})};return ot(()=>{k.value=new ut("#modal",{focus:!1})}),N({show:y,hide:r}),(e,h)=>{const v=et("VField"),g=et("ErrorMessage"),O=et("VForm");return F(),I("div",kt,[a("div",Ot,[a("div",Vt,[L(O,{onSubmit:vt(_,["prevent"])},{default:ft(({errors:x})=>[a("div",Yt,[a("h5",Tt,E(D.value==="created"?"新增":"修改")+"優惠卷 ",1),a("button",{type:"button",class:"btn-close",onClick:r})]),a("div",Ht,[a("div",Lt,[a("div",jt,[At,L(v,{id:"title",modelValue:d.value.title,"onUpdate:modelValue":h[0]||(h[0]=Y=>d.value.title=Y),modelModifiers:{trim:!0},name:"標題",type:"text",class:q(["form-control",{"is-invalid":x.標題}]),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),L(g,{name:"標題",class:"invalid-feedback"})]),a("div",Et,[Ut,L(v,{id:"code",modelValue:d.value.code,"onUpdate:modelValue":h[1]||(h[1]=Y=>d.value.code=Y),modelModifiers:{trim:!0},name:"折扣碼",type:"text",class:q(["form-control",{"is-invalid":x.折扣碼}]),placeholder:"請輸入折扣碼",rules:"required"},null,8,["modelValue","class"]),L(g,{name:"折扣碼",class:"invalid-feedback"})]),a("div",Ft,[Nt,L(v,{id:"percent",modelValue:d.value.percent,"onUpdate:modelValue":h[2]||(h[2]=Y=>d.value.percent=Y),modelModifiers:{number:!0},name:"折扣百分比",type:"text",class:q(["form-control",{"is-invalid":x.折扣百分比}]),placeholder:"請輸入折扣百分比",rules:"required"},null,8,["modelValue","class"]),L(g,{name:"折扣百分比",class:"invalid-feedback"})]),a("div",Wt,[It,lt(a("input",{id:"due_date","onUpdate:modelValue":h[3]||(h[3]=Y=>d.value.due_date=Y),type:"date",class:"form-control"},null,512),[[mt,d.value.due_date]])]),a("div",Pt,[a("div",Bt,[lt(a("input",{id:"enableSwitch","onUpdate:modelValue":h[4]||(h[4]=Y=>d.value.is_enabled=Y),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[pt,d.value.is_enabled]]),a("label",{class:q([[d.value.is_enabled?"text-success":"text-danger"],"form-check-label"]),for:"enableSwitch"},E(d.value.is_enabled?"啟用":"停用"),3)])])])]),a("div",{class:"modal-footer"},[a("button",{type:"button",class:"btn btn-outline-secondary",onClick:r}," 取消 "),Gt])]),_:1},8,["onSubmit"])])])])}}},zt={id:"modal2",class:"modal fade",tabindex:"-1","aria-labelledby":"modalLabel","aria-hidden":"true"},Jt={class:"modal-dialog"},Zt={class:"modal-content border-0"},Qt=a("h5",{id:"modalLabel",class:"modal-title text-white"},[a("span",null,"刪除優惠卷")],-1),Kt={class:"modal-body"},Rt={class:"text-danger"},Xt={class:"modal-footer"},te={__name:"DeleteCouponModal",emits:"getCoupons",setup(w,{expose:N,emit:V}){const p=at("$swal"),k=T(null),D=T(""),S=T(""),d=(_,{id:e,title:h})=>{k.value.show(),D.value=e,S.value=h},y=()=>{k.value.hide()},r=_=>{Dt(_).then(({data:e})=>{e.success&&(y(),p("成功",e.message).then(()=>V("get-coupons")))}).catch(e=>{var v,g,O,x;const h=((g=(v=e==null?void 0:e.response)==null?void 0:v.data)==null?void 0:g.message.length)>0?(x=(O=e==null?void 0:e.response)==null?void 0:O.data)==null?void 0:x.message.join():"有錯誤";p.fire("錯誤",h,"error"),y()})};return ot(()=>{k.value=new ut("#modal2",{focus:!1})}),N({show:d,hide:y}),(_,e)=>(F(),I("div",zt,[a("div",Jt,[a("div",Zt,[a("div",{class:"modal-header bg-danger"},[Qt,a("button",{type:"button",class:"btn-close",onClick:y})]),a("div",Kt,[z(" 是否刪除 "),a("strong",Rt,E(S.value),1),z(" Coupon(刪除後將無法恢復)。 ")]),a("div",Xt,[a("button",{type:"button",class:"btn btn-outline-secondary",onClick:y}," 取消 "),a("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=h=>r(D.value))}," 確認刪除 ")])])])]))}},ee={class:"container"},ne={class:"text-end"},se={class:"table"},ae=a("thead",null,[a("tr",null,[a("th",null,"標題"),a("th",null,"折扣碼"),a("th",null,"折扣百分比"),a("th",null,"到期日"),a("th",null,"啟用"),a("th",null,"操作")])],-1),oe={class:"btn-group",role:"group"},ie=["onClick"],le=["onClick"],ue={key:1},de=a("td",{class:"text-center",colspan:"5"}," 沒有優惠代碼，快新增一個吧！ ",-1),re=[de],$e={__name:"DashboardCoupons",setup(w){const N=at("$swal"),V=T([]),p=T({}),k=T(null),D=T(null),S=(r,_={})=>{k.value.show(r,_)},d=()=>{wt().then(({data:r})=>{r.success&&(V.value=r.coupons,p.value=r.pagination)}).catch(r=>{var _,e;N.fire("",((e=(_=r==null?void 0:r.response)==null?void 0:_.data)==null?void 0:e.message)||"有錯誤","error")})},y=(r,_)=>{D.value.show(r,_)};return ot(()=>{d()}),(r,_)=>(F(),I("section",null,[a("div",ee,[a("div",ne,[a("button",{type:"button",class:"btn btn-primary",onClick:_[0]||(_[0]=e=>S("created"))}," 新增優惠卷 ")]),a("table",se,[ae,a("tbody",null,[V.value.length>0?(F(!0),I(_t,{key:0},$t(V.value,e=>(F(),I("tr",{key:e.id},[a("td",null,E(e.title),1),a("td",null,E(e.code),1),a("td",null,E(e.percent),1),a("td",null,E(yt(Mt)(e.due_date)),1),a("td",null,[a("div",{class:q([e.is_enabled?"text-success":"text-danger"])},E(e.is_enabled?"啟用":"停用"),3)]),a("td",null,[a("div",oe,[a("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:h=>S("edit",e)}," 修改 ",8,ie),a("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:h=>y("delete",e)}," 刪除 ",8,le)])])]))),128)):(F(),I("tr",ue,re))])]),p.value.current_page?(F(),gt(ct,{key:0,"current-page":p.value.current_page,"total-pages":p.value.total_pages,"has-next":p.value.has_next,"has-pre":p.value.has_pre,onGetPage:d},null,8,["current-page","total-pages","has-next","has-pre"])):bt("",!0)]),L(qt,{ref_key:"addEditModal",ref:k,onGetCoupons:d},null,512),L(te,{ref_key:"deleteModal",ref:D,onGetCoupons:d},null,512)]))}};export{$e as default};
